<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slotæ¸¸æˆé…ç½®ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #1a1a2e;
            color: #eee;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .tabs {
            display: flex;
            background-color: #16213e;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            background-color: #16213e;
            color: #aaa;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 500;
        }
        
        .tab:hover {
            background-color: #1f3a5f;
            color: #fff;
        }
        
        .tab.active {
            background-color: #0f3460;
            color: #e94560;
            border-bottom: 3px solid #e94560;
        }
        
        .tab-content {
            background-color: #0f3460;
            padding: 30px;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #e94560;
            font-weight: 500;
        }
        
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #333;
            background-color: #1a1a2e;
            color: #fff;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #e94560;
        }
        
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        .checkbox-label {
            display: inline-block;
            color: #fff;
        }
        
        .btn {
            padding: 12px 30px;
            background-color: #e94560;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
        }
        
        .btn:hover {
            background-color: #c13651;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .btn-secondary {
            background-color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #555;
        }
        
        .config-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .config-card {
            background-color: #16213e;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }
        
        .config-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        }
        
        .config-card h3 {
            color: #e94560;
            margin-bottom: 10px;
        }
        
        .config-card p {
            color: #aaa;
            margin-bottom: 5px;
        }
        
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .payline-pattern {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .payline-pattern input {
            width: 60px;
        }
        
        .symbol-payouts {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
        }
        
        .symbol-payouts label {
            margin-bottom: 5px;
        }
        
        .symbol-payouts input {
            width: 100%;
        }
        
        #message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background-color: #4caf50;
            color: white;
            border-radius: 5px;
            display: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        
        #message.error {
            background-color: #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ° Slotæ¸¸æˆé…ç½®ç®¡ç†ç³»ç»Ÿ</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('list-configs')">é…ç½®åˆ—è¡¨</button>
            <button class="tab" onclick="showTab('create-config')">åˆ›å»ºé…ç½®</button>
            <button class="tab" onclick="showTab('manage-symbols')">ç¬¦å·ç®¡ç†</button>
            <button class="tab" onclick="showTab('manage-reels')">å·è½´ç®¡ç†</button>
            <button class="tab" onclick="showTab('manage-paylines')">æ”¯ä»˜çº¿ç®¡ç†</button>
            <button class="tab" onclick="showTab('test-spin')">æµ‹è¯•æ—‹è½¬</button>
        </div>
        
        <!-- é…ç½®åˆ—è¡¨ -->
        <div id="list-configs" class="tab-content active">
            <h2>Sloté…ç½®åˆ—è¡¨</h2>
            <button class="btn" onclick="loadConfigs()">åˆ·æ–°åˆ—è¡¨</button>
            <div id="config-list" class="config-list"></div>
        </div>
        
        <!-- åˆ›å»ºé…ç½® -->
        <div id="create-config" class="tab-content">
            <h2>åˆ›å»ºæ–°çš„Sloté…ç½®</h2>
            <form id="create-config-form">
                <div class="form-group">
                    <label>é…ç½®åç§°</label>
                    <input type="text" name="name" placeholder="ä¾‹å¦‚ï¼šLucky 777" required>
                </div>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label>è¡Œæ•° (Rows)</label>
                        <input type="number" name="rows" value="3" min="1" max="10" required>
                    </div>
                    
                    <div class="form-group">
                        <label>å·è½´æ•° (Reels)</label>
                        <input type="number" name="reels" value="5" min="3" max="10" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <input type="checkbox" id="is_megaway" name="is_megaway">
                    <label class="checkbox-label" for="is_megaway">å¯ç”¨Megawayæ¨¡å¼</label>
                </div>
                
                <div class="grid-2" id="megaway-options" style="display:none;">
                    <div class="form-group">
                        <label>æœ€å°Megawayè¡Œæ•°</label>
                        <input type="number" name="min_megaway_rows" value="2" min="2" max="6">
                    </div>
                    
                    <div class="form-group">
                        <label>æœ€å¤§Megawayè¡Œæ•°</label>
                        <input type="number" name="max_megaway_rows" value="7" min="3" max="10">
                    </div>
                </div>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label>é»˜è®¤èµŒæ³¨</label>
                        <input type="number" name="default_bet" value="1" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label>æœ€å°èµŒæ³¨</label>
                        <input type="number" name="min_bet" value="1" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label>æœ€å¤§èµŒæ³¨</label>
                        <input type="number" name="max_bet" value="1000" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label>RTPç™¾åˆ†æ¯”</label>
                        <input type="number" name="rtp_percentage" value="96.00" step="0.01" min="80" max="99" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <input type="checkbox" id="wild_enabled" name="wild_enabled" checked>
                    <label class="checkbox-label" for="wild_enabled">å¯ç”¨Wildç¬¦å·</label>
                </div>
                
                <div class="form-group">
                    <input type="checkbox" id="free_spins_enabled" name="free_spins_enabled" checked>
                    <label class="checkbox-label" for="free_spins_enabled">å¯ç”¨å…è´¹æ—‹è½¬</label>
                </div>
                
                <button type="submit" class="btn">åˆ›å»ºé…ç½®</button>
            </form>
        </div>
        
        <!-- ç¬¦å·ç®¡ç† -->
        <div id="manage-symbols" class="tab-content">
            <h2>ç¬¦å·ç®¡ç†</h2>
            <div class="form-group">
                <label>é€‰æ‹©Sloté…ç½®</label>
                <select id="symbol-config-select" onchange="loadSymbols()">
                    <option value="">è¯·é€‰æ‹©é…ç½®</option>
                </select>
            </div>
            
            <h3>æ·»åŠ æ–°ç¬¦å·</h3>
            <form id="add-symbol-form">
                <input type="hidden" id="symbol-config-id" name="slot_config_id">
                
                <div class="grid-2">
                    <div class="form-group">
                        <label>ç¬¦å·åç§°</label>
                        <input type="text" name="name" placeholder="ä¾‹å¦‚ï¼šCherry" required>
                    </div>
                    
                    <div class="form-group">
                        <label>ç¬¦å·ç±»å‹</label>
                        <select name="symbol_type" required>
                            <option value="normal">æ™®é€šç¬¦å·</option>
                            <option value="wild">Wildç¬¦å·</option>
                            <option value="scatter">Scatterç¬¦å·</option>
                            <option value="bonus">Bonusç¬¦å·</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>ç¬¦å·ä»·å€¼</label>
                        <input type="number" name="value" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label>å›¾ç‰‡URLï¼ˆå¯é€‰ï¼‰</label>
                        <input type="text" name="image_url" placeholder="https://example.com/cherry.png">
                    </div>
                </div>
                
                <h4>èµ”ä»˜å€æ•°</h4>
                <div class="symbol-payouts">
                    <div class="form-group">
                        <label>2xè¿çº¿</label>
                        <input type="number" name="payout_2x" value="0" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>3xè¿çº¿</label>
                        <input type="number" name="payout_3x" value="0" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>4xè¿çº¿</label>
                        <input type="number" name="payout_4x" value="0" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>5xè¿çº¿</label>
                        <input type="number" name="payout_5x" value="0" min="0">
                    </div>
                    
                    <div class="form-group">
                        <label>6xè¿çº¿</label>
                        <input type="number" name="payout_6x" value="0" min="0">
                    </div>
                </div>
                
                <button type="submit" class="btn">æ·»åŠ ç¬¦å·</button>
            </form>
            
            <h3>ç°æœ‰ç¬¦å·</h3>
            <div id="symbols-list"></div>
        </div>
        
        <!-- å·è½´ç®¡ç† -->
        <div id="manage-reels" class="tab-content">
            <h2>å·è½´ç®¡ç†</h2>
            <div class="form-group">
                <label>é€‰æ‹©Sloté…ç½®</label>
                <select id="reel-config-select" onchange="loadReels()">
                    <option value="">è¯·é€‰æ‹©é…ç½®</option>
                </select>
            </div>
            
            <h3>é…ç½®å·è½´ç¬¦å·</h3>
            <form id="add-reel-symbol-form">
                <input type="hidden" id="reel-config-id" name="slot_config_id">
                
                <div class="grid-2">
                    <div class="form-group">
                        <label>å·è½´ç¼–å·ï¼ˆä»0å¼€å§‹ï¼‰</label>
                        <input type="number" name="reel_number" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label>ä½ç½®ï¼ˆä»0å¼€å§‹ï¼‰</label>
                        <input type="number" name="position" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label>é€‰æ‹©ç¬¦å·</label>
                        <select id="reel-symbol-select" name="symbol_id" required>
                            <option value="">è¯·å…ˆé€‰æ‹©é…ç½®</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>æƒé‡ï¼ˆå‡ºç°é¢‘ç‡ï¼‰</label>
                        <input type="number" name="weight" value="1" min="1" required>
                    </div>
                </div>
                
                <button type="submit" class="btn">é…ç½®å·è½´ç¬¦å·</button>
            </form>
            
            <h3>å½“å‰å·è½´é…ç½®</h3>
            <div id="reels-list"></div>
        </div>
        
        <!-- æ”¯ä»˜çº¿ç®¡ç† -->
        <div id="manage-paylines" class="tab-content">
            <h2>æ”¯ä»˜çº¿ç®¡ç†</h2>
            <div class="form-group">
                <label>é€‰æ‹©Sloté…ç½®</label>
                <select id="payline-config-select" onchange="loadPaylines()">
                    <option value="">è¯·é€‰æ‹©é…ç½®</option>
                </select>
            </div>
            
            <h3>æ·»åŠ æ”¯ä»˜çº¿</h3>
            <form id="add-payline-form">
                <input type="hidden" id="payline-config-id" name="slot_config_id">
                
                <div class="form-group">
                    <label>æ”¯ä»˜çº¿ç¼–å·</label>
                    <input type="number" name="line_number" min="1" required>
                </div>
                
                <div class="form-group">
                    <label>æ”¯ä»˜çº¿æ¨¡å¼ï¼ˆæ ¼å¼ï¼šå·è½´,è¡Œ å·è½´,è¡Œ ...ï¼‰</label>
                    <input type="text" name="pattern" placeholder="0,0 1,0 2,0 3,0 4,0" required>
                    <small style="color: #aaa;">ä¾‹å¦‚ï¼š0,0 1,0 2,0 3,0 4,0 è¡¨ç¤ºç¬¬ä¸€è¡Œæ¨ªçº¿</small>
                </div>
                
                <div class="form-group">
                    <input type="checkbox" id="payline_active" name="is_active" checked>
                    <label class="checkbox-label" for="payline_active">æ¿€æ´»æ­¤æ”¯ä»˜çº¿</label>
                </div>
                
                <button type="submit" class="btn">æ·»åŠ æ”¯ä»˜çº¿</button>
            </form>
            
            <h3>ç°æœ‰æ”¯ä»˜çº¿</h3>
            <div id="paylines-list"></div>
        </div>
        
        <!-- æµ‹è¯•æ—‹è½¬ -->
        <div id="test-spin" class="tab-content">
            <h2>æµ‹è¯•æ—‹è½¬</h2>
            <div class="form-group">
                <label>é€‰æ‹©Sloté…ç½®</label>
                <select id="test-config-select">
                    <option value="">è¯·é€‰æ‹©é…ç½®</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>æ¯çº¿èµŒæ³¨</label>
                <input type="number" id="test-bet" value="1" min="1">
            </div>
            
            <button class="btn" onclick="testSpin()">æ—‹è½¬</button>
            
            <div id="spin-result" style="margin-top: 20px;"></div>
        </div>
    </div>
    
    <div id="message"></div>
    
    <script>
        const API_BASE = '/api/slot-config';
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, isError = false) {
            const messageEl = document.getElementById('message');
            messageEl.textContent = text;
            messageEl.className = isError ? 'error' : '';
            messageEl.style.display = 'block';
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 3000);
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function showTab(tabId) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabId).classList.add('active');
            
            // æ¿€æ´»å¯¹åº”çš„æ ‡ç­¾
            event.target.classList.add('active');
            
            // åŠ è½½ç›¸å…³æ•°æ®
            if (tabId === 'list-configs') {
                loadConfigs();
            } else if (tabId === 'manage-symbols' || tabId === 'manage-reels' || tabId === 'manage-paylines' || tabId === 'test-spin') {
                loadConfigSelects();
            }
        }
        
        // åŠ è½½é…ç½®åˆ—è¡¨
        async function loadConfigs() {
            try {
                const response = await fetch(API_BASE);
                const configs = await response.json();
                
                const listEl = document.getElementById('config-list');
                listEl.innerHTML = '';
                
                configs.forEach(config => {
                    const card = document.createElement('div');
                    card.className = 'config-card';
                    card.innerHTML = `
                        <h3>${config.name}</h3>
                        <p><strong>å°ºå¯¸ï¼š</strong> ${config.reels}x${config.rows}</p>
                        <p><strong>æ¨¡å¼ï¼š</strong> ${config.is_megaway ? 'Megaway' : 'æ ‡å‡†'}</p>
                        <p><strong>RTPï¼š</strong> ${config.rtp_percentage}%</p>
                        <p><strong>èµŒæ³¨èŒƒå›´ï¼š</strong> ${config.min_bet} - ${config.max_bet}</p>
                        <button class="btn btn-secondary" onclick="selectConfig(${config.id})">ç®¡ç†</button>
                    `;
                    listEl.appendChild(card);
                });
            } catch (error) {
                showMessage('åŠ è½½é…ç½®å¤±è´¥ï¼š' + error.message, true);
            }
        }
        
        // åŠ è½½é…ç½®é€‰æ‹©æ¡†
        async function loadConfigSelects() {
            try {
                const response = await fetch(API_BASE);
                const configs = await response.json();
                
                const selects = ['symbol-config-select', 'reel-config-select', 'payline-config-select', 'test-config-select'];
                
                selects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select) {
                        select.innerHTML = '<option value="">è¯·é€‰æ‹©é…ç½®</option>';
                        configs.forEach(config => {
                            select.innerHTML += `<option value="${config.id}">${config.name}</option>`;
                        });
                    }
                });
            } catch (error) {
                showMessage('åŠ è½½é…ç½®åˆ—è¡¨å¤±è´¥ï¼š' + error.message, true);
            }
        }
        
        // åˆ›å»ºé…ç½®è¡¨å•å¤„ç†
        document.getElementById('create-config-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {};
            
            formData.forEach((value, key) => {
                if (key === 'is_megaway' || key === 'wild_enabled' || key === 'free_spins_enabled') {
                    data[key] = e.target[key].checked;
                } else if (key.includes('_') || key === 'rows' || key === 'reels') {
                    data[key] = parseInt(value) || 0;
                } else if (key === 'rtp_percentage') {
                    data[key] = parseFloat(value);
                } else {
                    data[key] = value;
                }
            });
            
            try {
                const response = await fetch(API_BASE, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (response.ok) {
                    showMessage('é…ç½®åˆ›å»ºæˆåŠŸï¼');
                    e.target.reset();
                    loadConfigs();
                } else {
                    showMessage(result.error || 'åˆ›å»ºå¤±è´¥', true);
                }
            } catch (error) {
                showMessage('åˆ›å»ºé…ç½®å¤±è´¥ï¼š' + error.message, true);
            }
        });
        
        // Megawayé€‰é¡¹æ˜¾ç¤º/éšè—
        document.getElementById('is_megaway').addEventListener('change', (e) => {
            document.getElementById('megaway-options').style.display = e.target.checked ? 'grid' : 'none';
        });
        
        // åŠ è½½ç¬¦å·åˆ—è¡¨
        async function loadSymbols() {
            const configId = document.getElementById('symbol-config-select').value;
            if (!configId) return;
            
            document.getElementById('symbol-config-id').value = configId;
            
            try {
                const response = await fetch(`${API_BASE}/${configId}/symbols`);
                const symbols = await response.json();
                
                const listEl = document.getElementById('symbols-list');
                listEl.innerHTML = '<h4>ç¬¦å·åˆ—è¡¨ï¼š</h4>';
                
                if (symbols.length === 0) {
                    listEl.innerHTML += '<p>æš‚æ— ç¬¦å·</p>';
                } else {
                    const table = document.createElement('table');
                    table.style.width = '100%';
                    table.innerHTML = `
                        <tr>
                            <th>åç§°</th>
                            <th>ç±»å‹</th>
                            <th>ä»·å€¼</th>
                            <th>2x</th>
                            <th>3x</th>
                            <th>4x</th>
                            <th>5x</th>
                            <th>6x</th>
                        </tr>
                    `;
                    
                    symbols.forEach(symbol => {
                        table.innerHTML += `
                            <tr>
                                <td>${symbol.name}</td>
                                <td>${symbol.symbol_type}</td>
                                <td>${symbol.value}</td>
                                <td>${symbol.payout_2x || 0}</td>
                                <td>${symbol.payout_3x || 0}</td>
                                <td>${symbol.payout_4x || 0}</td>
                                <td>${symbol.payout_5x || 0}</td>
                                <td>${symbol.payout_6x || 0}</td>
                            </tr>
                        `;
                    });
                    
                    listEl.appendChild(table);
                }
            } catch (error) {
                showMessage('åŠ è½½ç¬¦å·å¤±è´¥ï¼š' + error.message, true);
            }
        }
        
        // æ·»åŠ ç¬¦å·è¡¨å•å¤„ç†
        document.getElementById('add-symbol-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                slot_config_id: parseInt(formData.get('slot_config_id')),
                name: formData.get('name'),
                symbol_type: formData.get('symbol_type'),
                value: parseInt(formData.get('value')),
                image_url: formData.get('image_url') || null,
                payouts: {}
            };
            
            // æ”¶é›†èµ”ä»˜æ•°æ®
            for (let i = 2; i <= 6; i++) {
                const payout = parseInt(formData.get(`payout_${i}x`)) || 0;
                if (payout > 0) {
                    data.payouts[i] = payout;
                }
            }
            
            try {
                const response = await fetch(`${API_BASE}/symbol`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (response.ok) {
                    showMessage('ç¬¦å·æ·»åŠ æˆåŠŸï¼');
                    e.target.reset();
                    loadSymbols();
                } else {
                    showMessage(result.error || 'æ·»åŠ å¤±è´¥', true);
                }
            } catch (error) {
                showMessage('æ·»åŠ ç¬¦å·å¤±è´¥ï¼š' + error.message, true);
            }
        });
        
        // åŠ è½½å·è½´é…ç½®
        async function loadReels() {
            const configId = document.getElementById('reel-config-select').value;
            if (!configId) return;
            
            document.getElementById('reel-config-id').value = configId;
            
            // åŠ è½½ç¬¦å·é€‰æ‹©æ¡†
            try {
                const symbolsResponse = await fetch(`${API_BASE}/${configId}/symbols`);
                const symbols = await symbolsResponse.json();
                
                const symbolSelect = document.getElementById('reel-symbol-select');
                symbolSelect.innerHTML = '<option value="">é€‰æ‹©ç¬¦å·</option>';
                symbols.forEach(symbol => {
                    symbolSelect.innerHTML += `<option value="${symbol.id}">${symbol.name} (${symbol.symbol_type})</option>`;
                });
                
                // åŠ è½½å·è½´é…ç½®
                const reelsResponse = await fetch(`${API_BASE}/${configId}/reels`);
                const reels = await reelsResponse.json();
                
                const listEl = document.getElementById('reels-list');
                listEl.innerHTML = '<h4>å·è½´é…ç½®ï¼š</h4>';
                
                if (reels.length === 0) {
                    listEl.innerHTML += '<p>æš‚æ— å·è½´é…ç½®</p>';
                } else {
                    // æŒ‰å·è½´åˆ†ç»„æ˜¾ç¤º
                    const reelGroups = {};
                    reels.forEach(reel => {
                        if (!reelGroups[reel.reel_number]) {
                            reelGroups[reel.reel_number] = [];
                        }
                        reelGroups[reel.reel_number].push(reel);
                    });
                    
                    Object.keys(reelGroups).sort((a, b) => parseInt(a) - parseInt(b)).forEach(reelNum => {
                        const div = document.createElement('div');
                        div.style.marginBottom = '20px';
                        div.innerHTML = `<h5>å·è½´ ${reelNum}ï¼š</h5>`;
                        
                        const table = document.createElement('table');
                        table.style.width = '100%';
                        table.innerHTML = `
                            <tr>
                                <th>ä½ç½®</th>
                                <th>ç¬¦å·</th>
                                <th>æƒé‡</th>
                            </tr>
                        `;
                        
                        reelGroups[reelNum].sort((a, b) => a.position - b.position).forEach(reel => {
                            table.innerHTML += `
                                <tr>
                                    <td>${reel.position}</td>
                                    <td>${reel.symbol_name} (${reel.symbol_type})</td>
                                    <td>${reel.weight}</td>
                                </tr>
                            `;
                        });
                        
                        div.appendChild(table);
                        listEl.appendChild(div);
                    });
                }
            } catch (error) {
                showMessage('åŠ è½½å·è½´é…ç½®å¤±è´¥ï¼š' + error.message, true);
            }
        }
        
        // æ·»åŠ å·è½´ç¬¦å·è¡¨å•å¤„ç†
        document.getElementById('add-reel-symbol-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = {
                slot_config_id: parseInt(formData.get('slot_config_id')),
                reel_number: parseInt(formData.get('reel_number')),
                position: parseInt(formData.get('position')),
                symbol_id: parseInt(formData.get('symbol_id')),
                weight: parseInt(formData.get('weight'))
            };
            
            try {
                const response = await fetch(`${API_BASE}/reel-symbol`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (response.ok) {
                    showMessage('å·è½´ç¬¦å·é…ç½®æˆåŠŸï¼');
                    loadReels();
                } else {
                    showMessage(result.error || 'é…ç½®å¤±è´¥', true);
                }
            } catch (error) {
                showMessage('é…ç½®å·è½´ç¬¦å·å¤±è´¥ï¼š' + error.message, true);
            }
        });
        
        // åŠ è½½æ”¯ä»˜çº¿
        async function loadPaylines() {
            const configId = document.getElementById('payline-config-select').value;
            if (!configId) return;
            
            document.getElementById('payline-config-id').value = configId;
            
            try {
                const response = await fetch(`${API_BASE}/${configId}/paylines`);
                const paylines = await response.json();
                
                const listEl = document.getElementById('paylines-list');
                listEl.innerHTML = '<h4>æ”¯ä»˜çº¿åˆ—è¡¨ï¼š</h4>';
                
                if (paylines.length === 0) {
                    listEl.innerHTML += '<p>æš‚æ— æ”¯ä»˜çº¿</p>';
                } else {
                    paylines.forEach(payline => {
                        const div = document.createElement('div');
                        div.style.marginBottom = '10px';
                        div.innerHTML = `
                            <strong>æ”¯ä»˜çº¿ ${payline.line_number}ï¼š</strong> 
                            ${JSON.stringify(payline.pattern)} 
                            ${payline.is_active ? '(æ¿€æ´»)' : '(æœªæ¿€æ´»)'}
                        `;
                        listEl.appendChild(div);
                    });
                }
            } catch (error) {
                showMessage('åŠ è½½æ”¯ä»˜çº¿å¤±è´¥ï¼š' + error.message, true);
            }
        }
        
        // æ·»åŠ æ”¯ä»˜çº¿è¡¨å•å¤„ç†
        document.getElementById('add-payline-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const patternStr = formData.get('pattern');
            const pattern = patternStr.split(' ').map(pair => {
                const [reel, row] = pair.split(',').map(n => parseInt(n));
                return [reel, row];
            });
            
            const data = {
                slot_config_id: parseInt(formData.get('slot_config_id')),
                line_number: parseInt(formData.get('line_number')),
                pattern: pattern,
                is_active: e.target.is_active.checked
            };
            
            try {
                const response = await fetch(`${API_BASE}/payline`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                if (response.ok) {
                    showMessage('æ”¯ä»˜çº¿æ·»åŠ æˆåŠŸï¼');
                    loadPaylines();
                } else {
                    showMessage(result.error || 'æ·»åŠ å¤±è´¥', true);
                }
            } catch (error) {
                showMessage('æ·»åŠ æ”¯ä»˜çº¿å¤±è´¥ï¼š' + error.message, true);
            }
        });
        
        // æµ‹è¯•æ—‹è½¬
        async function testSpin() {
            const configId = document.getElementById('test-config-select').value;
            const betPerLine = parseInt(document.getElementById('test-bet').value);
            
            if (!configId) {
                showMessage('è¯·é€‰æ‹©é…ç½®', true);
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/spin`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        slot_config_id: parseInt(configId),
                        bet_per_line: betPerLine
                    })
                });
                
                const result = await response.json();
                if (response.ok) {
                    displaySpinResult(result);
                } else {
                    showMessage(result.error || 'æ—‹è½¬å¤±è´¥', true);
                }
            } catch (error) {
                showMessage('æµ‹è¯•æ—‹è½¬å¤±è´¥ï¼š' + error.message, true);
            }
        }
        
        // æ˜¾ç¤ºæ—‹è½¬ç»“æœ
        function displaySpinResult(result) {
            const resultEl = document.getElementById('spin-result');
            
            let html = '<h3>æ—‹è½¬ç»“æœï¼š</h3>';
            
            // æ˜¾ç¤ºç½‘æ ¼
            html += '<div style="display: inline-block; background: #16213e; padding: 20px; border-radius: 10px;">';
            
            if (result.megaway_rows) {
                html += '<p>Megawayè¡Œæ•°ï¼š' + result.megaway_rows.join(', ') + '</p>';
            }
            
            // è½¬ç½®ç½‘æ ¼ä»¥æ­£ç¡®æ˜¾ç¤º
            const maxRows = Math.max(...result.grid.map(col => col.length));
            for (let row = 0; row < maxRows; row++) {
                html += '<div style="display: flex; gap: 10px; margin-bottom: 10px;">';
                for (let col = 0; col < result.grid.length; col++) {
                    if (row < result.grid[col].length) {
                        const symbol = result.grid[col][row];
                        html += `<div style="width: 80px; height: 80px; background: #0f3460; color: #e94560; display: flex; align-items: center; justify-content: center; border-radius: 5px; font-weight: bold;">
                            ${symbol.name}
                        </div>`;
                    } else {
                        html += '<div style="width: 80px; height: 80px;"></div>';
                    }
                }
                html += '</div>';
            }
            
            html += '</div>';
            
            // æ˜¾ç¤ºè·èƒœä¿¡æ¯
            html += '<div style="margin-top: 20px;">';
            html += `<p><strong>èµŒæ³¨ï¼š</strong> ${result.bet_per_line}</p>`;
            html += `<p><strong>è·èƒœçº¿æ•°ï¼š</strong> ${result.winning_lines.length}</p>`;
            html += `<p><strong>æ€»èµ¢é‡‘ï¼š</strong> ${result.total_win}</p>`;
            html += `<p><strong>å…è´¹æ—‹è½¬ï¼š</strong> ${result.free_spins}</p>`;
            
            if (result.winning_lines.length > 0) {
                html += '<h4>è·èƒœçº¿è¯¦æƒ…ï¼š</h4>';
                result.winning_lines.forEach(line => {
                    html += `<p>çº¿ ${line.payline_number}: ${line.symbols.map(s => s.name).join(' - ')} = ${line.win_multiplier}x</p>`;
                });
            }
            
            html += '</div>';
            
            resultEl.innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', () => {
            loadConfigs();
        });
    </script>
</body>
</html>